<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Rus-OGE-подобное тестирование</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f111a;
      --card: #171a23;
      --text: #eaeffb;
      --accent: #4e9af1;
      --muted: #aab3c5;
      --correct: #2e8b57;
      --wrong: #c0392b;
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: sans-serif; }
    .container { max-width: 1024px; margin: 0 auto; padding: 20px; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #2a2f44; }
    .title { font-size: 20px; font-weight: 600; }
    .progress { font-size: 14px; color: var(--muted); }
    .card { background: #141923; border: 1px solid #2a2f44; border-radius: 8px; padding: 16px; margin: 12px 0; }
    .question { font-size: 18px; line-height: 1.4; margin-bottom: 12px; }
    .options { list-style: none; padding: 0; margin: 0; }
    .option { padding: 12px; margin: 8px 0; border: 1px solid #2a2f44; border-radius: 8px; cursor: pointer; background: #1e2230; }
    .option:hover { background: #252a3b; }
    .option[data-state="correct"] { border-color: var(--correct); background: rgba(46,139,87,.15); }
    .option[data-state="wrong"] { border-color: var(--wrong); background: rgba(192,57,43,.15); }
    .controls { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-top: 12px; }
    button { padding: 10px 14px; border-radius: 6px; border: none; cursor: pointer; }
    .btn { background: var(--accent); color: white; }
    .btn.secondary { background: #2f3240; color: #e8e8e8; }
    .btn.primary { background: #1e90ff; color: white; }
    .footer { text-align: center; color: var(--muted); font-size: 12px; margin-top: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="title">Rus-OGE-подобное задание</div>
      <div class="progress" id="progressText">0 / 0</div>
    </header>

    <main id="quiz" aria-label="Тест">
      <!-- Разметка вопросов будет вставляться здесь -->
    </main>

    <section class="card" id="summary" hidden>
      <div class="question">Итоги теста</div>
      <div id="summaryText"></div>
      <div class="controls" style="margin-top:8px;">
        <button class="btn" id="retryBtn">Попробовать снова</button>
        <button class="btn secondary" id="exportBtn">Экспорт CSV</button>
      </div>
    </section>

    <footer class="footer" aria-label="подключение">
      Демонстрационная версия. В реальном проекте добавьте серверную аутентификацию и сохранение результатов.
    </footer>
  </main>

  <script>
    // Данные: массив заданий. Каждый элемент: вопрос, варианты, правильный индекс
    const data = [
      {
        text: "Какой орган управляет уровнем сахара в крови?",
        options: ["Печень", "Поджелудочная железа", "Селезенка", "Желудок"],
        answer: 1
      },
      {
        text: "Какой язык программирования чаще всего используется для веб-скриптов в браузере?",
        options: ["Python", "Java", "JavaScript", "C#"],
        answer: 2
      },
      {
        text: "Сколько континентов на планете?",
        options: ["5", "6", "7", "8"],
        answer: 2
      },
      // Добавьте больше вопросов по желанию
    ];

    const quizRoot = document.getElementById('quiz');
    const progressText = document.getElementById('progressText');
    const summarySection = document.getElementById('summary');
    const summaryText = document.getElementById('summaryText');
    const retryBtn = document.getElementById('retryBtn');
    const exportBtn = document.getElementById('exportBtn');

    let current = 0;
    const userAnswers = Array(data.length).fill(null);
    let locked = false;

    function renderQuestion(index) {
      quizRoot.innerHTML = '';
      const q = data[index];
      const card = document.createElement('section');
      card.className = 'card';

      const qEl = document.createElement('div');
      qEl.className = 'question';
      qEl.textContent = `Вопрос ${index + 1}: ${q.text}`;
      card.appendChild(qEl);

      const ul = document.createElement('ul');
      ul.className = 'options';
      q.options.forEach((opt, i) => {
        const li = document.createElement('li');
        li.className = 'option';
        li.textContent = opt;
        li.dataset.index = i;
        li.addEventListener('click', () => onChoose(index, i, li));
        ul.appendChild(li);
      });
      card.appendChild(ul);

      const controls = document.createElement('div');
      controls.className = 'controls';

      const prevBtn = document.createElement('button');
      prevBtn.textContent = 'Предыдущий';
      prevBtn.className = 'btn secondary';
      prevBtn.disabled = index === 0;
      prevBtn.addEventListener('click', () => goTo(index - 1));
      controls.appendChild(prevBtn);

      const nextBtn = document.createElement('button');
      nextBtn.textContent = index === data.length - 1 ? 'Завершить' : 'Следующий';
      nextBtn.className = 'btn';
      nextBtn.disabled = userAnswers[index] === null;
      nextBtn.addEventListener('click', () => {
        if (index < data.length - 1) goTo(index + 1);
        else finishQuiz();
      });
      controls.appendChild(nextBtn);

      card.appendChild(controls);

      quizRoot.appendChild(card);

      updateProgress();
    }

    function onChoose(qIndex, optionIndex, element) {
      if (locked) return;
      userAnswers[qIndex] = optionIndex;

      // визуальная подсветка
      const options = element.parentElement.querySelectorAll('.option');
      options.forEach((el) => {
        el.removeAttribute('data-state');
      });
      element.setAttribute('data-state', optionIndex === data[qIndex].answer ? 'correct' : 'wrong');
      // Разрешаем переход к следующему
      locked = true;
      // Разблокируем выбор и позволяем перейти
      setTimeout(() => {
        locked = false;
      }, 200);
      // Обновить активность кнопок
      renderQuestion(qIndex);
    }

    function goTo(index) {
      current = index;
      renderQuestion(current);
    }

    function updateProgress() {
      const answered = userAnswers.filter(v => v !== null).length;
      progressText.textContent = `Вопрос ${current + 1} из ${data.length} | Ответов: ${answered}`;
    }

    function finishQuiz() {
      // Подсчитать результат
      let correctCount = 0;
      data.forEach((q, i) => {
        if (userAnswers[i] === q.answer) correctCount++;
      });
      summaryText.textContent = `Вы ответили правильно на ${correctCount} из ${data.length} вопросов.`;
      summarySection.hidden = false;
      quizRoot.innerHTML = '';
    }

    function exportCSV() {
      // экспорт простого CSV
      const header = 'question,selected,correct\n';
      const rows = data.map((q, i) => {
        const sel = userAnswers[i] != null ? q.options[userAnswers[i]] : '';
        const correct = q.options[q.answer];
        // простейшая экранификация запятых
        const qtext = JSON.stringify(q.text).slice(1, -1);
        return `"${qtext}","${sel}","${correct}"`;
      });
      const csv = header + rows.join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'results.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Инициализация
    retryBtn.addEventListener('click', () => {
      // Сбрасываем состояние
      current = 0;
      userAnswers.fill(null);
      summarySection.hidden = true;
      renderQuestion(current);
    });

    exportBtn.addEventListener('click', exportCSV);

    // Первичный рендер
    renderQuestion(current);
  </script>
</body>
</html>
